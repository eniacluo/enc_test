#!/usr/bin/env python
import psutil
import subprocess
import ConfigParser

config = ConfigParser.ConfigParser()
config.readfp(open(r'../conf/config.sys'))
ip    = config.get('localdb', 'lip')
user  = config.get('localdb', 'luser')
passw = config.get('localdb', 'lpass')
db    = config.get('general', 'dbstatus')
unit  = config.get('general', 'unitid')


print ip
print user
print passw
print db
print unit

cpu = psutil.cpu_percent(interval=1)
mem = psutil.virtual_memory().percent
diskp= psutil.disk_usage('/').percent
diskt= (psutil.disk_usage('/').used)/1027/1024

print diskt
http_post = "curl -i -XPOST \'http://127.0.0.1:8086/write?db="+db+"\' -u "":"++"sensorweb --data-binary \' \n memory,location=RShake value=" +str(mem)+"\n cpu,location=RShake value="+ str(cpu);
http_post = http_post + "\n diskusagepercent,location=RShake value=" + str(diskp) +"\n diskusedsize,location=RShake value="+ str(diskt) + " \'  ";
#print http_post;
subprocess.call(http_post, shell=True)


